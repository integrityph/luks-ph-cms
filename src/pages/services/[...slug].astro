---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import ServiceAccordion from "../../component/ServiceAccordion.astro";

export async function getStaticPaths() {
  const services = await getCollection("services");
  const categories = await getCollection("categories");

  const paths = await Promise.all(
    services.map(async (treatment) => {
      const filteredCategory = categories.filter(
        (category) => category.data.treatment.id === treatment.id
      );

      return filteredCategory.map((category) => ({
        params: {
          slug: `${treatment.id}/${category.id}`,
        },
        props: { category },
      }));
    })
  );

  // Flatten array of arrays
  return paths.flat();
}

const { category } = Astro.props;
console.log(category);
---

<BaseLayout>
  <section class="page-header">
    <div
      class="page-header__bg"
      style={`background-image: url('${category.data.banner.src}');`}
    >
    </div>
    <div class="container">
      <div class="page-header__inner">
        <ul class="thm-breadcrumb list-unstyled">
          <li><a href="/">Home</a></li>
          <li><span>/</span></li>
          <li><a href="/services/">Services</a></li>
          <li><span>/</span></li>

          <li>{category.data.title}</li>
        </ul>

        <h2>{category.data.title}</h2>
      </div>
    </div>
  </section>
  <section class="services-details-two">
    <div class="container">
      <div class="row">
        <div class="col-xl-12 col-lg-12">
          <div class="services-details-two__right">
            <div
              class="services-details-two__img wow fadeInDown animated"
              data-wow-delay="100ms"
              data-wow-duration="2500ms"
              style="visibility: visible; animation-duration: 2500ms; animation-delay: 100ms; animation-name: fadeInDown;"
            >
              <img
                src={category.data.photo.src}
                alt=""
              />
            </div>

            <h3 class="services-details-two__title-1">
              {category.data.title}
            </h3>
            <p class="services-details-two__text-1">
              {category.data.description}
            </p>

            <br />
            <div class="services-details-two__faq">
              <d
                class="accrodion-grp faq-one-accrodion"
                data-grp-name="faq-one-accrodion"
              >
                {
                  category.data.services.map((service) => (
                    <ServiceAccordion service={service} />
                  ))
                }
              </d>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
